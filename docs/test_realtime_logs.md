# 实时日志功能测试指南

## 测试步骤

### 1. 启动后端服务

```bash
cd backend
python run.py
```

预期输出:
```
✅ LLM服务初始化成功
INFO:     Started server process [xxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### 2. 启动前端服务

```bash
cd frontend
npm run dev
```

预期输出:
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:5173/
➜  Network: use --host to expose
```

### 3. 测试实时日志功能

#### 步骤 A: 访问首页
1. 打开浏览器访问 http://localhost:5173
2. 确认页面正常加载

#### 步骤 B: 填写表单
1. 目的地城市: 输入 "南京"
2. 开始日期: 选择今天
3. 结束日期: 选择明天 (2天行程)
4. 交通方式: 选择 "公共交通"
5. 住宿偏好: 选择 "经济型酒店"
6. 旅行偏好: 勾选 "历史文化"

#### 步骤 C: 提交并观察日志
1. 点击 "开始规划我的旅行" 按钮
2. 观察页面出现:
   - 进度条开始加载
   - 实时日志窗口出现
   - 日志消息逐条显示

#### 步骤 D: 验证日志内容
应该看到以下日志消息(按顺序):

```
============================================================
📥 收到旅行规划请求:
城市: 南京
日期: 2025-11-10 - 2025-11-11
天数: 2
============================================================
🔄 获取多智能体系统实例...
🚀 开始生成旅行计划...
============================================================
🚀 开始多智能体协作规划旅行...
目的地: 南京 | 日期: 2025-11-10 至 2025-11-11 | 天数: 2天
============================================================
⚡ 并行查询景点、天气、酒店信息...
📝 查询南京的天气信息...
✅ 天气信息查询完成
🏨 搜索南京的经济型酒店酒店...
✅ 酒店信息查询完成
✅ 信息查询完成
📋 生成行程计划...
✅ 旅行计划生成完成!
✅ 旅行计划生成成功,准备返回响应
```

#### 步骤 E: 验证日志着色
- ✅ 成功消息应该显示为绿色
- 🚀 信息消息应该显示为蓝色
- 普通消息显示为灰白色

#### 步骤 F: 验证自动滚动
- 日志窗口应该自动滚动到最新消息
- 最新的日志应该始终可见

#### 步骤 G: 验证最终结果
- 日志完成后,页面应该跳转到结果页面
- 结果页面应该显示完整的旅行计划

### 4. 测试错误处理

#### 测试 A: 网络错误
1. 停止后端服务
2. 在前端提交表单
3. 应该看到错误消息

#### 测试 B: 无效输入
1. 不填写城市名称
2. 点击提交
3. 应该看到表单验证错误

### 5. 测试并发请求

1. 打开两个浏览器标签页
2. 在两个标签页中同时提交不同的旅行计划
3. 验证两个标签页的日志互不干扰
4. 验证两个请求都能正常完成

## 预期结果

✅ 日志实时显示,无延迟
✅ 日志着色正确
✅ 自动滚动工作正常
✅ 最终结果正确返回
✅ 错误处理正确
✅ 并发请求互不干扰

## 常见问题

### Q: 日志不显示
A: 检查:
1. 后端是否正常运行
2. 浏览器控制台是否有错误
3. 网络请求是否成功

### Q: 日志显示延迟
A: 可能原因:
1. 网络延迟
2. 后端处理慢
3. 浏览器性能问题

### Q: 日志乱码
A: 确认:
1. 后端使用 `ensure_ascii=False`
2. 前端使用 UTF-8 解码
3. 浏览器编码设置正确

## 性能测试

### 测试日志流性能
```bash
# 使用 curl 测试 SSE 端点
curl -X POST http://localhost:8000/api/trip/plan-stream \
  -H "Content-Type: application/json" \
  -d '{
    "city": "南京",
    "start_date": "2025-11-10",
    "end_date": "2025-11-11",
    "travel_days": 2,
    "transportation": "公共交通",
    "accommodation": "经济型酒店",
    "preferences": ["历史文化"]
  }'
```

预期: 应该看到实时的 SSE 数据流

## 调试技巧

### 查看后端日志
```bash
# 后端控制台会同时输出日志
# 可以对比前端显示和后端输出
```

### 查看浏览器网络请求
1. 打开浏览器开发者工具
2. 切换到 Network 标签
3. 找到 `/api/trip/plan-stream` 请求
4. 查看 Response 标签,应该看到 SSE 数据流

### 查看浏览器控制台
```javascript
// 可以在控制台查看日志
console.log('日志消息:', message)
```

## 测试清单

- [ ] 后端服务正常启动
- [ ] 前端服务正常启动
- [ ] 表单提交成功
- [ ] 日志实时显示
- [ ] 日志着色正确
- [ ] 自动滚动工作
- [ ] 最终结果正确
- [ ] 错误处理正确
- [ ] 并发请求正常
- [ ] 清空日志功能正常
- [ ] 页面跳转正常
- [ ] 历史记录保存正常
